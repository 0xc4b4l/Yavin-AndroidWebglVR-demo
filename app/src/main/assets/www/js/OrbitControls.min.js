THREE.OrbitControls=function(e,t){function r(){return 2*Math.PI/60/60*d.autoRotateSpeed}function i(){return Math.pow(.95,d.zoomSpeed)}function n(e){if(d.enabled!==!1){if(e.preventDefault(),e.button===d.mouseButtons.ORBIT){if(d.noRotate===!0)return;D=F.ROTATE,m.set(e.clientX,e.clientY)}else if(e.button===d.mouseButtons.ZOOM){if(d.noZoom===!0)return;D=F.DOLLY,b.set(e.clientX,e.clientY)}else if(e.button===d.mouseButtons.PAN){if(d.noPan===!0)return;D=F.PAN,v.set(e.clientX,e.clientY)}document.addEventListener("mousemove",o,!1),document.addEventListener("mouseup",a,!1),d.dispatchEvent(V)}}function o(e){if(d.enabled!==!1){e.preventDefault();var t=d.domElement===document?d.domElement.body:d.domElement;if(D===F.ROTATE){if(d.noRotate===!0)return;g.set(e.clientX,e.clientY),T.subVectors(g,m),d.rotateLeft(2*Math.PI*T.x/t.clientWidth*d.rotateSpeed),d.rotateUp(2*Math.PI*T.y/t.clientHeight*d.rotateSpeed),m.copy(g)}else if(D===F.DOLLY){if(d.noZoom===!0)return;w.set(e.clientX,e.clientY),_.subVectors(w,b),_.y>0?d.dollyIn():d.dollyOut(),b.copy(w)}else if(D===F.PAN){if(d.noPan===!0)return;y.set(e.clientX,e.clientY),R.subVectors(y,v),d.pan(R.x,R.y),v.copy(y)}d.update()}}function a(){d.enabled!==!1&&(document.removeEventListener("mousemove",o,!1),document.removeEventListener("mouseup",a,!1),d.dispatchEvent(k),D=F.NONE)}function s(e){if(d.enabled!==!1&&d.noZoom!==!0){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?d.dollyOut():d.dollyIn(),d.update(),d.dispatchEvent(V),d.dispatchEvent(k)}}function h(e){if(d.enabled!==!1&&d.noKeys!==!0&&d.noPan!==!0)switch(e.keyCode){case d.keys.UP:d.pan(0,d.keyPanSpeed),d.update();break;case d.keys.BOTTOM:d.pan(0,-d.keyPanSpeed),d.update();break;case d.keys.LEFT:d.pan(d.keyPanSpeed,0),d.update();break;case d.keys.RIGHT:d.pan(-d.keyPanSpeed,0),d.update()}}function l(e){if(d.enabled!==!1){switch(e.touches.length){case 1:if(d.noRotate===!0)return;D=F.TOUCH_ROTATE,m.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(d.noZoom===!0)return;D=F.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);b.set(0,i);break;case 3:if(d.noPan===!0)return;D=F.TOUCH_PAN,v.set(e.touches[0].pageX,e.touches[0].pageY);break;default:D=F.NONE}d.dispatchEvent(V)}}function c(e){if(d.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=d.domElement===document?d.domElement.body:d.domElement;switch(e.touches.length){case 1:if(d.noRotate===!0)return;if(D!==F.TOUCH_ROTATE)return;g.set(e.touches[0].pageX,e.touches[0].pageY),T.subVectors(g,m),d.rotateLeft(2*Math.PI*T.x/t.clientWidth*d.rotateSpeed),d.rotateUp(2*Math.PI*T.y/t.clientHeight*d.rotateSpeed),m.copy(g),d.update();break;case 2:if(d.noZoom===!0)return;if(D!==F.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,n=Math.sqrt(r*r+i*i);w.set(0,n),_.subVectors(w,b),_.y>0?d.dollyOut():d.dollyIn(),b.copy(w),d.update();break;case 3:if(d.noPan===!0)return;if(D!==F.TOUCH_PAN)return;y.set(e.touches[0].pageX,e.touches[0].pageY),R.subVectors(y,v),d.pan(R.x,R.y),v.copy(y),d.update();break;default:D=F.NONE}}}function u(){d.enabled!==!1&&(d.dispatchEvent(k),D=F.NONE)}this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var f,E,d=this,p=1e-6,m=new THREE.Vector2,g=new THREE.Vector2,T=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,R=new THREE.Vector2,x=new THREE.Vector3,H=new THREE.Vector3,b=new THREE.Vector2,w=new THREE.Vector2,_=new THREE.Vector2,M=0,S=0,C=1,A=new THREE.Vector3,L=new THREE.Vector3,P=new THREE.Quaternion,F={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},D=F.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var U=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),B=U.clone().inverse(),z={type:"change"},V={type:"start"},k={type:"end"};this.rotateLeft=function(e){void 0===e&&(e=r()),S-=e},this.rotateUp=function(e){void 0===e&&(e=r()),M-=e},this.panLeft=function(e){var t=this.object.matrix.elements;x.set(t[0],t[1],t[2]),x.multiplyScalar(-e),A.add(x)},this.panUp=function(e){var t=this.object.matrix.elements;x.set(t[4],t[5],t[6]),x.multiplyScalar(e),A.add(x)},this.pan=function(e,t){var r=d.domElement===document?d.domElement.body:d.domElement;if(void 0!==d.object.fov){var i=d.object.position,n=i.clone().sub(d.target),o=n.length();o*=Math.tan(d.object.fov/2*Math.PI/180),d.panLeft(2*e*o/r.clientHeight),d.panUp(2*t*o/r.clientHeight)}else void 0!==d.object.top?(d.panLeft(e*(d.object.right-d.object.left)/r.clientWidth),d.panUp(t*(d.object.top-d.object.bottom)/r.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){void 0===e&&(e=i()),C/=e},this.dollyOut=function(e){void 0===e&&(e=i()),C*=e},this.update=function(){var e=this.object.position;H.copy(e).sub(this.target),H.applyQuaternion(U),f=Math.atan2(H.x,H.z),E=Math.atan2(Math.sqrt(H.x*H.x+H.z*H.z),H.y),this.autoRotate&&this.rotateLeft(r()),f+=S,E+=M,f=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,f)),E=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,E)),E=Math.max(p,Math.min(Math.PI-p,E));var t=H.length()*C;t=Math.max(this.minDistance,Math.min(this.maxDistance,t)),this.target.add(A),H.x=t*Math.sin(E)*Math.sin(f),H.y=t*Math.cos(E),H.z=t*Math.sin(E)*Math.cos(f),H.applyQuaternion(B),e.copy(this.target).add(H),this.object.lookAt(this.target),S=0,M=0,C=1,A.set(0,0,0),(L.distanceToSquared(this.object.position)>p||8*(1-P.dot(this.object.quaternion))>p)&&(this.dispatchEvent(z),L.copy(this.object.position),P.copy(this.object.quaternion))},this.reset=function(){D=F.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.getPolarAngle=function(){return E},this.getAzimuthalAngle=function(){return f},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",n,!1),this.domElement.addEventListener("mousewheel",s,!1),this.domElement.addEventListener("DOMMouseScroll",s,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",u,!1),this.domElement.addEventListener("touchmove",c,!1),window.addEventListener("keydown",h,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);